# ESP32开发环境配置指南

## 📋 目录

- [系统要求](#系统要求)
- [方案选择](#方案选择)
- [方案A：VS Code + ESP-IDF插件（强烈推荐）](#方案a-vs-code--esp-idf-插件强烈推荐)
- [方案B：ESP-IDF命令行](#方案b-esp-idf-命令行)
- [方案C：Arduino IDE（不推荐）](#方案c-arduino-ide不推荐)
- [验证安装](#验证安装)
- [常见问题](#常见问题)

---

## 系统要求

### 硬件要求
- **电脑**：Windows 10/11（64位）
- **内存**：至少4GB（推荐8GB）
- **硬盘**：至少5GB空闲空间
- **USB接口**：至少1个可用USB口

### 软件需求
- **操作系统**：Windows 10/11
- **权限**：管理员权限
- **网络**：稳定的互联网连接（首次安装）

---

## 方案选择

| 方案 | 优点 | 缺点 | 推荐度 |
|------|------|------|--------|
| **方案A：VS Code + ESP-IDF** | 功能强大、智能提示、调试方便 | 安装稍复杂 | ⭐⭐⭐⭐⭐ |
| **方案B：ESP-IDF命令行** | 轻量、官方支持 | 没有IDE辅助 | ⭐⭐⭐ |
| **方案C：Arduino IDE** | 简单易用 | 功能受限、不支持高级特性 | ⭐⭐ |

### 为什么不用Keil？
**Keil MDK主要用于STM32，不支持ESP32！**
- ❌ Keil仅支持ARM Cortex-M/R内核
- ❌ ESP32是Xtensa LX6架构，Keil不兼容
- ✅ ESP32必须使用ESP-IDF或Arduino框架

---

## 方案A：VS Code + ESP-IDF 插件（强烈推荐）

这是最适合你项目的方案，功能强大且易于使用。

### 步骤1：安装Visual Studio Code

1. 下载VS Code：
   - 官网：https://code.visualstudio.com/
   - 或直接下载：[VSCodeUserSetup-x64-1.85.exe](https://code.visualstudio.com/sha/download?build=stable&os=win32-x64-user)

2. 安装VS Code：
   - 双击安装包
   - 勾选 "添加到PATH"
   - 勾选 "添加到资源管理器右键菜单"
   - 其他默认即可

3. 验证安装：
   ```powershell
   code --version
   ```
   应显示版本号

### 步骤2：安装ESP-IDF插件

1. 打开VS Code

2. 安装中文语言包（可选）：
   - 按 `Ctrl+Shift+X` 打开扩展商店
   - 搜索 "Chinese"
   - 安装 "Chinese (Simplified) Language Pack"
   - 重启VS Code

3. 安装ESP-IDF插件：
   - 按 `Ctrl+Shift+X` 打开扩展商店
   - 搜索 "ESP-IDF"
   - 找到 "Espressif IDF" 插件
   - 点击 "Install"

   ![ESP-IDF插件](https://docs.espressif.com/projects/vscode-esp-idf-extension/en/latest/_static/espressif_extension.png)

### 步骤3：配置ESP-IDF

1. 按 `Ctrl+Shift+P` 打开命令面板

2. 输入并选择：`ESP-IDF: Configure ESP-IDF Extension`

3. 选择 **EXPRESS** 模式（快速安装）

4. 配置选项：
   ```
   - Select ESP-IDF version: v5.1 (release version)
   - Select download server: GitHub
   - Select Python version: Use system Python 3.8+
   - Install directory: C:\Espressif
   ```

5. 点击 "Install"

6. **等待安装完成（首次约15-30分钟）**：
   - 下载ESP-IDF框架（约500MB）
   - 下载工具链
   - 配置Python环境
   - 安装依赖库

   > ⚠️ 安装过程中**不要关闭VS Code**

7. 安装完成后，会显示：
   ```
   ✓ ESP-IDF has been configured successfully
   ```

### 步骤4：安装USB驱动

ESP32开发板通过USB连接电脑，需要安装串口驱动。

#### 4.1 检测芯片型号

将ESP32开发板插入电脑USB口，打开设备管理器：
```powershell
# PowerShell命令
devmgmt.msc
```

在 "端口(COM和LPT)" 中查看：
- **CH340** → 显示为 "USB-SERIAL CH340"
- **CP2102** → 显示为 "Silicon Labs CP210x"
- **显示黄色感叹号** → 需要安装驱动

#### 4.2 安装CH340驱动（如果是CH340芯片）

1. 下载驱动：
   - 官方链接：http://www.wch.cn/downloads/CH341SER_EXE.html
   - 或直接下载：[CH341SER.EXE](http://www.wch.cn/downloads/file/5.html)

2. 解压并运行 `CH341SER.EXE`

3. 点击 "安装"

4. 重新插拔USB线

5. 验证：设备管理器中出现 `COM3` 或 `COM4` 等

#### 4.3 安装CP2102驱动（如果是CP2102芯片）

1. 下载驱动：
   - 官方链接：https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers
   - 选择 "CP210x Universal Windows Driver"

2. 解压并运行 `CP210xVCPInstaller_x64.exe`

3. 重启电脑

4. 验证：设备管理器中出现 `Silicon Labs CP210x USB to UART Bridge (COM3)`

### 步骤5：验证环境

1. 在VS Code中，按 `Ctrl+Shift+P`

2. 输入：`ESP-IDF: Show Examples Projects`

3. 选择 `get-started` → `hello_world`

4. 会自动打开示例项目

5. 点击底部状态栏的图标：
   - 🔌 选择串口（如COM3）
   - 🎯 选择目标（ESP32）
   - 🔨 点击 "Build"（编译）

6. 编译成功后，点击 ⚡ "Flash"（烧录）

7. 烧录成功后，点击 📺 "Monitor"（监视器）

8. 应该看到：
   ```
   Hello world!
   This is esp32 chip with 2 CPU core(s), WiFi/BT/BLE...
   ```

✅ **恭喜！环境配置成功！**

---

## 方案B：ESP-IDF 命令行

如果你更喜欢命令行，或VS Code安装失败，可以使用此方案。

### 步骤1：下载ESP-IDF离线安装器

1. 访问：https://dl.espressif.com/dl/esp-idf/

2. 下载最新版本：
   - **esp-idf-tools-setup-online-5.1.exe**（在线安装器，推荐）
   - 或 **esp-idf-tools-setup-offline-5.1.exe**（离线包，约2GB）

### 步骤2：安装ESP-IDF

1. 运行安装程序

2. 选择安装选项：
   ```
   - ESP-IDF Version: v5.1 (release)
   - Installation directory: C:\Espressif
   - Python: Install Python 3.11
   - Git: Install Git for Windows
   ```

3. 勾选：
   - ✅ Download tools
   - ✅ Download ESP-IDF
   - ✅ Add to PATH

4. 点击 "Install"

5. 等待安装完成（约20-40分钟）

### 步骤3：安装USB驱动

同 [方案A的步骤4](#步骤4安装usb驱动)

### 步骤4：测试命令行

1. 桌面会出现快捷方式：**ESP-IDF 5.1 CMD**

2. 双击打开，执行：
   ```powershell
   idf.py --version
   ```
   应显示：`ESP-IDF v5.1.x`

3. 测试串口：
   ```powershell
   esptool.py --help
   ```

4. 测试编译：
   ```powershell
   cd %IDF_PATH%\examples\get-started\hello_world
   idf.py build
   ```

✅ 安装成功！

---

## 方案C：Arduino IDE（不推荐）

Arduino IDE简单，但功能受限，**不适合本项目的复杂需求**。

### 为什么不推荐？
- ❌ 不支持FreeRTOS高级特性
- ❌ 库版本不统一，兼容性差
- ❌ 无法使用ESP-IDF的组件
- ❌ 调试功能弱

### 如果坚持使用：

1. 下载Arduino IDE：https://www.arduino.cc/en/software

2. 安装ESP32支持包：
   - 文件 → 首选项
   - 附加开发板管理器网址：
     ```
     https://espressif.github.io/arduino-esp32/package_esp32_index.json
     ```
   - 工具 → 开发板 → 开发板管理器
   - 搜索 "ESP32"
   - 安装 "esp32 by Espressif Systems"

3. 选择开发板：
   - 工具 → 开发板 → ESP32 Dev Module

---

## 验证安装

### 检查清单

- [ ] VS Code或命令行工具可以正常运行
- [ ] `idf.py --version` 显示版本号
- [ ] 设备管理器中出现COMx端口
- [ ] 能够编译Hello World示例
- [ ] 能够烧录并看到串口输出

### 测试烧录

1. 连接ESP32到USB

2. 打开终端（VS Code内置或ESP-IDF CMD）

3. 进入示例目录：
   ```powershell
   cd C:\Espressif\frameworks\esp-idf-v5.1\examples\get-started\hello_world
   ```

4. 设置目标芯片：
   ```powershell
   idf.py set-target esp32
   ```

5. 编译：
   ```powershell
   idf.py build
   ```

6. 烧录（替换COM3为你的端口）：
   ```powershell
   idf.py -p COM3 flash
   ```

7. 监视输出：
   ```powershell
   idf.py -p COM3 monitor
   ```
   按 `Ctrl+]` 退出监视器

8. 一步完成（编译+烧录+监视）：
   ```powershell
   idf.py -p COM3 flash monitor
   ```

---

## 常见问题

### 问题1：安装ESP-IDF插件后，VS Code无法识别ESP-IDF

**解决方案**：
```powershell
# 1. 重新配置ESP-IDF
Ctrl+Shift+P → ESP-IDF: Configure ESP-IDF Extension

# 2. 检查Python路径
Ctrl+Shift+P → Python: Select Interpreter
# 应显示：C:\Espressif\python_env\idf5.1_py3.11_env\Scripts\python.exe

# 3. 重启VS Code
```

### 问题2：编译报错 `CMake not found`

**解决方案**：
```powershell
# ESP-IDF安装器会自动安装CMake
# 如果没有，手动安装：

# 方法1：通过ESP-IDF安装器修复
# 重新运行 esp-idf-tools-setup.exe，选择 "Repair"

# 方法2：手动安装CMake
# 下载：https://cmake.org/download/
# 选择：cmake-3.27.x-windows-x86_64.msi
```

### 问题3：烧录报错 `Failed to connect to ESP32`

**解决方案**：
```powershell
# 1. 检查USB连接
# 重新插拔USB线

# 2. 确认端口号
# PowerShell:
Get-PnpDevice -Class Ports

# 3. 尝试手动进入下载模式
# 按住ESP32的BOOT键，然后按一下RESET键，再松开BOOT键

# 4. 使用更低波特率
idf.py -p COM3 -b 115200 flash

# 5. 检查驱动
# 设备管理器中查看是否有黄色感叹号
```

### 问题4：串口监视器乱码

**解决方案**：
```powershell
# 1. 确认波特率
idf.py -p COM3 monitor -b 115200

# 2. 按ESP32的RESET键重启

# 3. 如果仍然乱码，重新烧录bootloader
idf.py -p COM3 erase_flash
idf.py -p COM3 flash
```

### 问题5：电脑识别不到ESP32

**解决方案**：
1. 更换USB数据线（必须是**数据线**，不是充电线）
2. 更换USB接口（建议用主板后面的USB口）
3. 重新安装驱动
4. 检查ESP32是否损坏（板载LED是否亮）

### 问题6：安装速度慢

**解决方案**：
```powershell
# 使用国内镜像（清华大学源）

# 方法1：设置环境变量
$env:IDF_GITHUB_ASSETS="dl.espressif.com/github_assets"

# 方法2：手动下载离线安装包
# 访问：https://dl.espressif.com/dl/esp-idf/
# 下载：esp-idf-tools-setup-offline-5.1.exe
```

---

## 🎓 下一步

环境配置完成后，继续：
1. 📖 [硬件接线说明](02_硬件接线说明.md)
2. 🧪 开始模块测试：[test_modules/01_OLED_Test](../test_modules/01_OLED_Test/README.md)

---

## 📞 需要帮助？

如果遇到其他问题：
1. 查看ESP-IDF官方文档：https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/get-started/
2. 访问ESP32中文社区：https://www.esp32.com/
3. 检查USB线和驱动

---

**祝配置顺利！🚀**
